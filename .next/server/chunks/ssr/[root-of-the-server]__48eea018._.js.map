{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/niloysaha/Documents/Documents%20-%20Niloy%E2%80%99s%20MacBook%20Air/Udemy%20Web%20dev%20proj/AI%20Study%20Companion/lib/supabase.ts"],"sourcesContent":["import {createClient} from \"@supabase/supabase-js\";\n\nexport const createSupabaseClient = () => {\n    return createClient(\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n    )\n}"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,uBAAuB;IAChC,OAAO,IAAA,iRAAY;AAIvB","debugId":null}},
    {"offset": {"line": 53, "column": 0}, "map": {"version":3,"sources":["file:///Users/niloysaha/Documents/Documents%20-%20Niloy%E2%80%99s%20MacBook%20Air/Udemy%20Web%20dev%20proj/AI%20Study%20Companion/lib/actions/companion.actions.ts"],"sourcesContent":["'use server';\n\nimport {auth} from \"@clerk/nextjs/server\";\nimport {createSupabaseClient} from \"@/lib/supabase\";\nimport { revalidatePath } from \"next/cache\";\n\nexport const createCompanion = async (formData: CreateCompanion) => {\n    // Check if Supabase environment variables are configured\n    if (!process.env.NEXT_PUBLIC_SUPABASE_URL || !process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY) {\n        console.warn('Supabase environment variables not configured. Cannot create companion.');\n        return null;\n    }\n\n    const { userId: author } = await auth();\n    const supabase = createSupabaseClient();\n\n    const { data, error } = await supabase\n        .from('companions')\n        .insert({...formData, author })\n        .select();\n\n    if(error) {\n        console.error('Supabase error creating companion:', error.message);\n        return null;\n    }\n\n    if(!data) {\n        console.error('No data returned from companion creation');\n        return null;\n    }\n\n    return data[0];\n}\n\nexport const getAllCompanions = async ({ limit = 10, page = 1, subject, topic }: GetAllCompanions) => {\n    // Check if Supabase environment variables are configured\n    if (!process.env.NEXT_PUBLIC_SUPABASE_URL || !process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY) {\n        console.warn('Supabase environment variables not configured. Returning empty array.');\n        return [];\n    }\n\n    const supabase = createSupabaseClient();\n\n    let query = supabase.from('companions').select();\n\n    if(subject && topic) {\n        query = query.ilike('subject', `%${subject}%`)\n            .or(`topic.ilike.%${topic}%,name.ilike.%${topic}%`)\n    } else if(subject) {\n        query = query.ilike('subject', `%${subject}%`)\n    } else if(topic) {\n        query = query.or(`topic.ilike.%${topic}%,name.ilike.%${topic}%`)\n    }\n\n    query = query.range((page - 1) * limit, page * limit - 1);\n\n    const { data: companions, error } = await query;\n\n    if(error) {\n        console.error('Supabase error:', error.message);\n        return [];\n    }\n\n    return companions || [];\n}\n\nexport const getCompanion = async (id: string) => {\n    const supabase = createSupabaseClient();\n\n    const { data, error } = await supabase\n        .from('companions')\n        .select()\n        .eq('id', id);\n\n    if(error) return console.log(error);\n\n    return data[0];\n}\n\nexport const addToSessionHistory = async (companionId: string) => {\n    const { userId } = await auth();\n    const supabase = createSupabaseClient();\n    const { data, error } = await supabase.from('session_history')\n        .insert({\n            companion_id: companionId,\n            user_id: userId,\n        })\n\n    if(error) throw new Error(error.message);\n\n    return data;\n}\n\nexport const getRecentSessions = async (limit = 10) => {\n    // Check if Supabase environment variables are configured\n    if (!process.env.NEXT_PUBLIC_SUPABASE_URL || !process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY) {\n        console.warn('Supabase environment variables not configured. Returning empty array.');\n        return [];\n    }\n\n    const supabase = createSupabaseClient();\n    const { data, error } = await supabase\n        .from('session_history')\n        .select(`companions:companion_id (*)`)\n        .order('created_at', { ascending: false })\n        .limit(limit)\n\n    if(error) {\n        console.error('Supabase error:', error.message);\n        return [];\n    }\n\n    return data?.map(({ companions }) => companions) || [];\n}\n\nexport const getUserSessions = async (userId: string, limit = 10) => {\n    const supabase = createSupabaseClient();\n    const { data, error } = await supabase\n        .from('session_history')\n        .select(`companions:companion_id (*)`)\n        .eq('user_id', userId)\n        .order('created_at', { ascending: false })\n        .limit(limit)\n\n    if(error) throw new Error(error.message);\n\n    return data.map(({ companions }) => companions);\n}\n\nexport const getUserCompanions = async (userId: string) => {\n    const supabase = createSupabaseClient();\n    const { data, error } = await supabase\n        .from('companions')\n        .select()\n        .eq('author', userId)\n\n    if(error) throw new Error(error.message);\n\n    return data;\n}\n\nexport const newCompanionPermissions = async () => {\n    const { userId, has } = await auth();\n    \n    // Check if Supabase environment variables are configured\n    if (!process.env.NEXT_PUBLIC_SUPABASE_URL || !process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY) {\n        // If no database configured, allow unlimited companions for now\n        return true;\n    }\n\n    const supabase = createSupabaseClient();\n    let limit = 10; // Default limit for free users\n\n    if(has({ plan: 'pro' })) {\n        return true;\n    } else if(has({ feature: \"3_companion_limit\" })) {\n        limit = 3;\n    } else if(has({ feature: \"10_companion_limit\" })) {\n        limit = 10;\n    }\n\n    const { data, error } = await supabase\n        .from('companions')\n        .select('id', { count: 'exact' })\n        .eq('author', userId)\n\n    if(error) {\n        console.error('Supabase error:', error.message);\n        return true; // Allow creation if database error\n    }\n\n    const companionCount = data?.length || 0;\n\n    if(companionCount >= limit) {\n        return false\n    } else {\n        return true;\n    }\n}\n\n// Bookmarks\nexport const addBookmark = async (companionId: string, path: string) => {\n  const { userId } = await auth();\n  if (!userId) return;\n  const supabase = createSupabaseClient();\n  const { data, error } = await supabase.from(\"bookmarks\").insert({\n    companion_id: companionId,\n    user_id: userId,\n  });\n  if (error) {\n    throw new Error(error.message);\n  }\n  // Revalidate the path to force a re-render of the page\n\n  revalidatePath(path);\n  return data;\n};\n\nexport const removeBookmark = async (companionId: string, path: string) => {\n  const { userId } = await auth();\n  if (!userId) return;\n  const supabase = createSupabaseClient();\n  const { data, error } = await supabase\n    .from(\"bookmarks\")\n    .delete()\n    .eq(\"companion_id\", companionId)\n    .eq(\"user_id\", userId);\n  if (error) {\n    throw new Error(error.message);\n  }\n  revalidatePath(path);\n  return data;\n};\n\n// It's almost the same as getUserCompanions, but it's for the bookmarked companions\nexport const getBookmarkedCompanions = async (userId: string) => {\n  const supabase = createSupabaseClient();\n  const { data, error } = await supabase\n    .from(\"bookmarks\")\n    .select(`companions:companion_id (*)`) // Notice the (*) to get all the companion data\n    .eq(\"user_id\", userId);\n  if (error) {\n    throw new Error(error.message);\n  }\n  // We don't need the bookmarks data, so we return only the companions\n  return data.map(({ companions }) => companions);\n};"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAEA;AACA;AACA;;;;;;AAEO,MAAM,kBAAkB,OAAO;IAClC,yDAAyD;IACzD;;IAKA,MAAM,EAAE,QAAQ,MAAM,EAAE,GAAG,MAAM,IAAA,8YAAI;IACrC,MAAM,WAAW,IAAA,uIAAoB;IAErC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SACzB,IAAI,CAAC,cACL,MAAM,CAAC;QAAC,GAAG,QAAQ;QAAE;IAAO,GAC5B,MAAM;IAEX,IAAG,OAAO;QACN,QAAQ,KAAK,CAAC,sCAAsC,MAAM,OAAO;QACjE,OAAO;IACX;IAEA,IAAG,CAAC,MAAM;QACN,QAAQ,KAAK,CAAC;QACd,OAAO;IACX;IAEA,OAAO,IAAI,CAAC,EAAE;AAClB;AAEO,MAAM,mBAAmB,OAAO,EAAE,QAAQ,EAAE,EAAE,OAAO,CAAC,EAAE,OAAO,EAAE,KAAK,EAAoB;IAC7F,yDAAyD;IACzD;;IAKA,MAAM,WAAW,IAAA,uIAAoB;IAErC,IAAI,QAAQ,SAAS,IAAI,CAAC,cAAc,MAAM;IAE9C,IAAG,WAAW,OAAO;QACjB,QAAQ,MAAM,KAAK,CAAC,WAAW,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,EACxC,EAAE,CAAC,CAAC,aAAa,EAAE,MAAM,cAAc,EAAE,MAAM,CAAC,CAAC;IAC1D,OAAO,IAAG,SAAS;QACf,QAAQ,MAAM,KAAK,CAAC,WAAW,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC;IACjD,OAAO,IAAG,OAAO;QACb,QAAQ,MAAM,EAAE,CAAC,CAAC,aAAa,EAAE,MAAM,cAAc,EAAE,MAAM,CAAC,CAAC;IACnE;IAEA,QAAQ,MAAM,KAAK,CAAC,CAAC,OAAO,CAAC,IAAI,OAAO,OAAO,QAAQ;IAEvD,MAAM,EAAE,MAAM,UAAU,EAAE,KAAK,EAAE,GAAG,MAAM;IAE1C,IAAG,OAAO;QACN,QAAQ,KAAK,CAAC,mBAAmB,MAAM,OAAO;QAC9C,OAAO,EAAE;IACb;IAEA,OAAO,cAAc,EAAE;AAC3B;AAEO,MAAM,eAAe,OAAO;IAC/B,MAAM,WAAW,IAAA,uIAAoB;IAErC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SACzB,IAAI,CAAC,cACL,MAAM,GACN,EAAE,CAAC,MAAM;IAEd,IAAG,OAAO,OAAO,QAAQ,GAAG,CAAC;IAE7B,OAAO,IAAI,CAAC,EAAE;AAClB;AAEO,MAAM,sBAAsB,OAAO;IACtC,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAA,8YAAI;IAC7B,MAAM,WAAW,IAAA,uIAAoB;IACrC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,mBACvC,MAAM,CAAC;QACJ,cAAc;QACd,SAAS;IACb;IAEJ,IAAG,OAAO,MAAM,IAAI,MAAM,MAAM,OAAO;IAEvC,OAAO;AACX;AAEO,MAAM,oBAAoB,OAAO,QAAQ,EAAE;IAC9C,yDAAyD;IACzD;;IAKA,MAAM,WAAW,IAAA,uIAAoB;IACrC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SACzB,IAAI,CAAC,mBACL,MAAM,CAAC,CAAC,2BAA2B,CAAC,EACpC,KAAK,CAAC,cAAc;QAAE,WAAW;IAAM,GACvC,KAAK,CAAC;IAEX,IAAG,OAAO;QACN,QAAQ,KAAK,CAAC,mBAAmB,MAAM,OAAO;QAC9C,OAAO,EAAE;IACb;IAEA,OAAO,MAAM,IAAI,CAAC,EAAE,UAAU,EAAE,GAAK,eAAe,EAAE;AAC1D;AAEO,MAAM,kBAAkB,OAAO,QAAgB,QAAQ,EAAE;IAC5D,MAAM,WAAW,IAAA,uIAAoB;IACrC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SACzB,IAAI,CAAC,mBACL,MAAM,CAAC,CAAC,2BAA2B,CAAC,EACpC,EAAE,CAAC,WAAW,QACd,KAAK,CAAC,cAAc;QAAE,WAAW;IAAM,GACvC,KAAK,CAAC;IAEX,IAAG,OAAO,MAAM,IAAI,MAAM,MAAM,OAAO;IAEvC,OAAO,KAAK,GAAG,CAAC,CAAC,EAAE,UAAU,EAAE,GAAK;AACxC;AAEO,MAAM,oBAAoB,OAAO;IACpC,MAAM,WAAW,IAAA,uIAAoB;IACrC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SACzB,IAAI,CAAC,cACL,MAAM,GACN,EAAE,CAAC,UAAU;IAElB,IAAG,OAAO,MAAM,IAAI,MAAM,MAAM,OAAO;IAEvC,OAAO;AACX;AAEO,MAAM,0BAA0B;IACnC,MAAM,EAAE,MAAM,EAAE,GAAG,EAAE,GAAG,MAAM,IAAA,8YAAI;IAElC,yDAAyD;IACzD;;IAKA,MAAM,WAAW,IAAA,uIAAoB;IACrC,IAAI,QAAQ,IAAI,+BAA+B;IAE/C,IAAG,IAAI;QAAE,MAAM;IAAM,IAAI;QACrB,OAAO;IACX,OAAO,IAAG,IAAI;QAAE,SAAS;IAAoB,IAAI;QAC7C,QAAQ;IACZ,OAAO,IAAG,IAAI;QAAE,SAAS;IAAqB,IAAI;QAC9C,QAAQ;IACZ;IAEA,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SACzB,IAAI,CAAC,cACL,MAAM,CAAC,MAAM;QAAE,OAAO;IAAQ,GAC9B,EAAE,CAAC,UAAU;IAElB,IAAG,OAAO;QACN,QAAQ,KAAK,CAAC,mBAAmB,MAAM,OAAO;QAC9C,OAAO,MAAM,mCAAmC;IACpD;IAEA,MAAM,iBAAiB,MAAM,UAAU;IAEvC,IAAG,kBAAkB,OAAO;QACxB,OAAO;IACX,OAAO;QACH,OAAO;IACX;AACJ;AAGO,MAAM,cAAc,OAAO,aAAqB;IACrD,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAA,8YAAI;IAC7B,IAAI,CAAC,QAAQ;IACb,MAAM,WAAW,IAAA,uIAAoB;IACrC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,aAAa,MAAM,CAAC;QAC9D,cAAc;QACd,SAAS;IACX;IACA,IAAI,OAAO;QACT,MAAM,IAAI,MAAM,MAAM,OAAO;IAC/B;IACA,uDAAuD;IAEvD,IAAA,8QAAc,EAAC;IACf,OAAO;AACT;AAEO,MAAM,iBAAiB,OAAO,aAAqB;IACxD,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAA,8YAAI;IAC7B,IAAI,CAAC,QAAQ;IACb,MAAM,WAAW,IAAA,uIAAoB;IACrC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,aACL,MAAM,GACN,EAAE,CAAC,gBAAgB,aACnB,EAAE,CAAC,WAAW;IACjB,IAAI,OAAO;QACT,MAAM,IAAI,MAAM,MAAM,OAAO;IAC/B;IACA,IAAA,8QAAc,EAAC;IACf,OAAO;AACT;AAGO,MAAM,0BAA0B,OAAO;IAC5C,MAAM,WAAW,IAAA,uIAAoB;IACrC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,aACL,MAAM,CAAC,CAAC,2BAA2B,CAAC,EAAE,+CAA+C;KACrF,EAAE,CAAC,WAAW;IACjB,IAAI,OAAO;QACT,MAAM,IAAI,MAAM,MAAM,OAAO;IAC/B;IACA,qEAAqE;IACrE,OAAO,KAAK,GAAG,CAAC,CAAC,EAAE,UAAU,EAAE,GAAK;AACtC;;;IA5Na;IA4BA;IAgCA;IAaA;IAcA;IAsBA;IAcA;IAYA;IAwCA;IAiBA;IAiBA;;AAjNA,8WAAA;AA4BA,8WAAA;AAgCA,8WAAA;AAaA,8WAAA;AAcA,8WAAA;AAsBA,8WAAA;AAcA,8WAAA;AAYA,8WAAA;AAwCA,8WAAA;AAiBA,8WAAA;AAiBA,8WAAA","debugId":null}},
    {"offset": {"line": 278, "column": 0}, "map": {"version":3,"sources":["file:///Users/niloysaha/Documents/Documents%20-%20Niloy%E2%80%99s%20MacBook%20Air/Udemy%20Web%20dev%20proj/AI%20Study%20Companion/components/CompanionForm.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/components/CompanionForm.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/CompanionForm.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,uYAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAgS,GAC7T,8DACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 292, "column": 0}, "map": {"version":3,"sources":["file:///Users/niloysaha/Documents/Documents%20-%20Niloy%E2%80%99s%20MacBook%20Air/Udemy%20Web%20dev%20proj/AI%20Study%20Companion/components/CompanionForm.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/components/CompanionForm.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/CompanionForm.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,uYAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA4Q,GACzS,0CACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 306, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 314, "column": 0}, "map": {"version":3,"sources":["file:///Users/niloysaha/Documents/Documents%20-%20Niloy%E2%80%99s%20MacBook%20Air/Udemy%20Web%20dev%20proj/AI%20Study%20Companion/app/companions/new/page.tsx"],"sourcesContent":["import CompanionForm from \"@/components/CompanionForm\";\nimport {auth} from \"@clerk/nextjs/server\";\nimport {redirect} from \"next/navigation\";\nimport {newCompanionPermissions} from \"@/lib/actions/companion.actions\";\nimport Image from \"next/image\";\nimport Link from \"next/link\";\n\nconst NewCompanion = async () => {\n    const { userId } = await auth();\n    if(!userId) redirect('/sign-in');\n\n    const canCreateCompanion = await newCompanionPermissions();\n\n    return (\n        <main className=\"min-lg:w-1/3 min-md:w-2/3 items-center justify-center\">\n            {canCreateCompanion ? (\n                <article className=\"w-full gap-4 flex flex-col\">\n                    <h1>Companion Builder</h1>\n\n                    <CompanionForm />\n                </article>\n                ) : (\n                    <article className=\"companion-limit\">\n                        <Image src=\"/images/limit.svg\" alt=\"Companion limit reached\" width={360} height={230} />\n                        <div className=\"cta-badge\">\n                            Upgrade your plan\n                        </div>\n                        <h1>You’ve Reached Your Limit</h1>\n                        <p>You’ve reached your companion limit. Upgrade to create more companions and premium features.</p>\n                        <Link href=\"/subscription\" className=\"btn-primary w-full justify-center\" >\n                            Upgrade My Plan\n                        </Link>\n                    </article>\n                )}\n        </main>\n    )\n}\n\nexport default NewCompanion"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;;;;;;;;AAEA,MAAM,eAAe;IACjB,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAA,8YAAI;IAC7B,IAAG,CAAC,QAAQ,IAAA,gUAAQ,EAAC;IAErB,MAAM,qBAAqB,MAAM,IAAA,iKAAuB;IAExD,qBACI,6WAAC;QAAK,WAAU;kBACX,mCACG,6WAAC;YAAQ,WAAU;;8BACf,6WAAC;8BAAG;;;;;;8BAEJ,6WAAC,uIAAa;;;;;;;;;;qEAGd,6WAAC;YAAQ,WAAU;;8BACf,6WAAC,uQAAK;oBAAC,KAAI;oBAAoB,KAAI;oBAA0B,OAAO;oBAAK,QAAQ;;;;;;8BACjF,6WAAC;oBAAI,WAAU;8BAAY;;;;;;8BAG3B,6WAAC;8BAAG;;;;;;8BACJ,6WAAC;8BAAE;;;;;;8BACH,6WAAC,sSAAI;oBAAC,MAAK;oBAAgB,WAAU;8BAAqC;;;;;;;;;;;;;;;;;AAOlG;uCAEe","debugId":null}}]
}